# BMTNavigationBar
è§£å†³å¯¼èˆªæ titleViewä¸å……æ»¡å…¨å±çš„é—®é¢˜ï¼Œå¹¶é€‚é…iOS11ã€‚

>å…¬å¸çš„Appæ˜¯å±…äºiOS8ä»¥ä¸Šçš„ï¼Œé¡µé¢æ˜¾ç¤ºåœ¨iOS8~iOS10éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯ï¼ŒiOS11betaç‰ˆæ˜¾ç¤ºå‡ºç°å„ç§é—®é¢˜ï¼ŒçœŸæ˜¯é¡¾å®¢è™ä½ åƒç™¾éï¼Œä½ å¾…é¡¾å®¢å¦‚åˆæ‹ï¼Œè‹¹æœæäº‹ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½æš—æš—çš„æ‰¿å—ã€‚ğŸ˜œ

### æäº‹ä¸€ï¼šå¯¼èˆªæ 
#### 1.å¯¼èˆªæ é«˜åº¦å˜åŒ–
å¯¼èˆªæ åœ¨iOS10ä¹‹å‰éƒ½æ˜¯é»˜è®¤çš„64pï¼Œä½†æ˜¯ï¼Œåˆ°äº†iOS10å°±ä¸å•å•æ˜¯64päº†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ç³»ç»Ÿçš„ä¿¡æ¯Appï¼Œåœ¨iOS11æ·»åŠ äº†å¤§æ ‡é¢˜ï¼Œæ•ˆæœå¦‚ä¸‹å›¾1ï¼š
![å›¾1.png](http://upload-images.jianshu.io/upload_images/968977-410f670afe737036.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

navigationBarçš„ç»“æ„ï¼Œçœ‹å›¾2ã€3ã€4:
![å›¾2.png](http://upload-images.jianshu.io/upload_images/968977-d8b3b973da772f58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![å›¾3.png](http://upload-images.jianshu.io/upload_images/968977-eda62ec78c92a749.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![å›¾4.png](http://upload-images.jianshu.io/upload_images/968977-1ccd0e3e986513a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

åœ¨ä¸Šé¢ä¸‰å¹…å›¾å¯ä»¥çŸ¥é“ï¼Œåœ¨iOS11å¯¼èˆªæ å¤šäº†ä¸€ä¸ªLargeTitleViewï¼Œä¸“é—¨æ˜¾ç¤ºå¤§å­—æ ‡é¢˜ç”¨çš„ï¼Œæ•´ä¸ªå¯¼èˆªæ çš„é«˜åº¦è¾¾åˆ°äº†96pï¼Œè¿™ä¸åŒ…æ‹¬çŠ¶æ€æ çš„é«˜åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªappé¡¶éƒ¨é«˜åº¦è¾¾åˆ°äº†116pï¼Œå…¶ä¸­statusbar=20ï¼Œtitle=44ï¼Œlargetitle=52ï¼Œä¸è¿‡é»˜è®¤æ˜¯64pï¼›å½“ç„¶ï¼Œ**iPhoneX**çš„é«˜åº¦ä¼šæ›´é«˜ç‚¹ï¼Œå¦‚æœä¸æ˜¾ç¤ºå¤§å­—æ ‡é¢˜ï¼Œé¡¶éƒ¨çš„é«˜åº¦ä¹Ÿè¾¾åˆ°äº†88ï¼Œstatusbar=44ï¼Œtitle=44ï¼Œå¦‚æœæ˜¾ç¤ºå¤§å­—æ ‡é¢˜ï¼Œåˆ™é«˜åº¦å˜æˆäº†140ï¼Œstatusbar=44ï¼Œtitle=44ï¼Œlargetitle=52ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**iPhoneX**çš„åˆ˜æµ·é«˜åº¦ä¸º24pï¼Œå¤§å­—æ ‡é¢˜å¦‚ä¸‹å›¾ï¼š

![iPhoneXä¹‹å‰çš„æœºå‹.png](http://upload-images.jianshu.io/upload_images/968977-89a88f618da51832.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![iPhoneX.png](http://upload-images.jianshu.io/upload_images/968977-b19a09df0a51bf50.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### 2.å¯¼èˆªæ çš„å›¾å±‚å˜åŒ–
iOS11ä¹‹å‰å¯¼èˆªæ çš„titleæ˜¯æ·»åŠ åœ¨UINavigationItemViewä¸Šé¢ï¼Œè€ŒnavigationBarButtonåˆ™ç›´æ¥æ·»åŠ åœ¨navigationBarä¸Šé¢ï¼›å¦‚æœè®¾ç½®äº†titleViewï¼Œåˆ™titleViewä¹Ÿæ˜¯ç›´æ¥æ·»åŠ åœ¨navigationBarä¸Šé¢ï¼Œå¦‚å›¾5:

![å›¾5.png](http://upload-images.jianshu.io/upload_images/968977-c6fe6299a9fedd8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


åœ¨iOS11ä¹‹åï¼Œè‹¹æœæ·»åŠ äº†æ–°çš„ç±»æ¥ç®¡ç†ï¼ŒnavigationBarä¼šæ·»åŠ åœ¨_UIButtonBarStackViewä¸Šé¢ï¼Œè€Œ_UIButtonBarStackViewåˆ™æ·»åŠ åœ¨_UINavigationBarContentViewä¸Šé¢ï¼›å¦‚æœæ²¡æœ‰ç»™titleViewèµ‹å€¼ï¼Œåˆ™titleViewä¼šç›´æ¥æ·»åŠ åœ¨_UINavigationBarContentViewä¸Šé¢ï¼Œå¦‚æœèµ‹å€¼ç»™äº†titleViewï¼Œåˆ™ä¼šæ–°ç”Ÿæˆ_UITAMICAdaptorViewï¼ŒæŠŠtitleViewæ·»åŠ åœ¨è¿™ä¸ªç±»ä¸Šé¢ï¼Œè¿™ä¸ªç±»ä¼šæ·»åŠ åœ¨_UINavigationBarContentViewä¸Šé¢ï¼Œå¦‚ä¸‹å›¾6ã€7:

![å›¾6.png](http://upload-images.jianshu.io/upload_images/968977-9ce6865faee333d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![å›¾7.png](http://upload-images.jianshu.io/upload_images/968977-4d38220d0a6bc66a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### 3.å¯¼èˆªæ çš„è¾¹è·å˜åŒ–
åœ¨iOS11å¯¹å¯¼èˆªæ é‡Œé¢çš„itemçš„è¾¹è·ä¹Ÿåšäº†è°ƒæ•´ï¼š
###### ï¼ˆ1ï¼‰å¦‚æœåªæ˜¯è®¾ç½®äº†titleViewï¼Œæ²¡æœ‰è®¾ç½®barbuttonï¼ŒæŠŠtitleviewçš„å®½åº¦è®¾ç½®ä¸ºå±å¹•å®½åº¦ï¼Œåˆ™titleviewè·ç¦»å±å¹•çš„è¾¹è·ï¼ŒiOS11ä¹‹å‰ï¼Œåœ¨iPhone6pä¸Šæ˜¯20pï¼Œåœ¨iPhone6pä¹‹å‰æ˜¯16pï¼›iOS11ä¹‹åï¼Œåœ¨iPhone6pä¸Šæ˜¯12pï¼Œåœ¨iPhone6pä¹‹å‰æ˜¯8pã€‚
###### ï¼ˆ2ï¼‰å¦‚æœåªæ˜¯è®¾ç½®äº†barbuttonï¼Œæ²¡æœ‰è®¾ç½®titleviewï¼Œåˆ™åœ¨iOS11é‡Œï¼ŒbarButtonè·ç¦»å±å¹•çš„è¾¹è·æ˜¯20på’Œ16pï¼›åœ¨iOS11ä¹‹å‰ï¼ŒbarButtonè·ç¦»å±å¹•çš„è¾¹è·ä¹Ÿæ˜¯20på’Œ16pã€‚
###### ï¼ˆ3ï¼‰å¦‚æœåŒæ—¶è®¾ç½®äº†titleViewå’ŒbarButtonï¼Œåˆ™åœ¨iOS11ä¹‹å‰ï¼Œtitleviewå’Œbarbuttonä¹‹é—´çš„é—´è·æ˜¯6pï¼Œåœ¨iOS11ä¸Štitleviewå’Œbarbuttonä¹‹é—´æ— é—´è·ï¼Œå¦‚ä¸‹å›¾8ã€9:

![å›¾8.png](http://upload-images.jianshu.io/upload_images/968977-f3ace14e6195da4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![å›¾9.png](http://upload-images.jianshu.io/upload_images/968977-32b1d97a39d15160.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### 4.Appéœ€è¦å®ç°å¯¼èˆªæ å·¦å³æŒ‰é’®è¾¹è·ä¸º0
åœ¨iOS11ä¹‹å‰ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªwidthä¸ºè´Ÿçš„navigationBarButtonï¼Œå°†æŒ‰é’®æŒ¤åˆ°è¾¹ç¼˜ï¼Œå˜ç›¸å®ç°0è¾¹è·çš„å¯¼èˆªæ æŒ‰é’®ï¼Œä½†æ˜¯ï¼Œè¿™æ‹›åœ¨iOS11å¤±æ•ˆäº†ï¼ŒåŸå› åœ¨äº_UIButtonBarStackViewï¼Œè¿™ä¸ªiOS9ä¹‹åå‡ºæ¥çš„ï¼Œç”¨æ¥ç›¸å¯¹å¸ƒå±€çš„ç»„ä»¶ï¼Œé™åˆ¶äº†å­viewçš„å¸ƒå±€ã€‚é‚£æ€ä¹ˆæå‘¢ï¼Ÿ

**æƒ³åˆ°çš„æ–¹æ³•æœ‰å‡ ä¸ªï¼š**
ï¼ˆ1ï¼‰åœ¨viewWillAppearé‡Œé¢ï¼Œå°†_UIButtonBarStackViewå–å‡ºæ¥ï¼Œç›´æ¥è®¾ç½®å®ƒçš„xåæ ‡ã€‚
ï¼ˆ2ï¼‰è®¾ç½®titleViewï¼Œç„¶åå°†buttonæ·»åŠ åœ¨titleViewä¸Šé¢ï¼Œæ ¹æ®ä¸åŒçš„è¾¹è·åšåç§»ã€‚

æ–¹æ³•ä¸€ï¼š
é‡åˆ°çš„é—®é¢˜ï¼Œåœ¨viewDidLoadï¼ŒviewWillAppearï¼ŒviewWillLayoutSubviewsï¼ŒviewDidLayoutSubviewsé‡Œé¢éƒ½å–ä¸åˆ°_UIButtonBarStackViewï¼Œåªæœ‰åœ¨viewDidAppearé‡Œæ‰èƒ½å–åˆ°å€¼ï¼Œè¿™æ ·å°±ä¼šåœ¨é¡µé¢æ˜¾ç¤ºäº†ä¹‹åæ‰å¼€å§‹ç§»åŠ¨navigationBarButtonï¼Œæ˜¾ç„¶è¿™æ ·ä½“éªŒä¸å¥½ï¼Œæ‰€ä»¥ï¼Œæš‚æ—¶passæ‰ã€‚

æ–¹æ³•äºŒï¼š
è¿™ä¸ªåšæ³•å®Œå…¨å¯ä»¥åšåˆ°0è¾¹è·ï¼Œä½†æ˜¯ï¼Œé—®é¢˜æ¥äº†ï¼Œå°±æ˜¯ç‚¹å‡»åŒºåŸŸçš„é—®é¢˜ã€‚å› ä¸ºå·¦å³navigationBarButtonçš„ç‚¹å‡»åŒºåŸŸæ˜¯è¶…å‡ºçˆ¶viewçš„ï¼Œæ‰€ä»¥ï¼Œç‚¹å‡»ä¸åˆ°ã€‚è¿™å¥½åŠï¼Œé‡å†™titleViewçš„hitTestæ–¹æ³•å°±å¥½ã€‚å˜¿å˜¿å˜¿ï¼Œé—®é¢˜æ²¡æœ‰é‚£ä¹ˆç®€å•ã€‚ä¹‹å‰åœ¨iOS11çš„å›¾å±‚ç»“æ„å°±è§£é‡Šè¿‡ï¼ŒtitleViewä¼šè¢«æ·»åŠ åœ¨_UITAMICAdaptorViewä¸Šé¢ï¼Œè€Œé‡ç‚¹æ˜¯ï¼Œè¿™ä¸ªviewä¹Ÿæœ‰è¾¹è·ï¼Œæ‰€ä»¥ï¼Œå•å•é‡å†™titleViewçš„hitTestæ–¹æ³•è¿˜ä¸å¤Ÿï¼Œé‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæˆ‘çš„åŠæ³•å°±æ˜¯å†™ä¸€ä¸ªviewçš„ç±»åˆ«ï¼Œhookæ‰€æœ‰viewçš„hitTestæ–¹æ³•ï¼Œåœ¨é‡Œé¢åˆ¤æ–­æ˜¯å¦æ˜¯iOS11ä»¥ä¸Šï¼Œæ˜¯å¦æ˜¯_UITAMICAdaptorViewç±»ï¼Œå¦‚æœéƒ½æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¯ä»¥æäº‹äº†ã€‚ğŸ˜œ[Demo](https://github.com/jashion/BMTNavigationBar/tree/master)
### æäº‹äºŒï¼šåˆ—è¡¨çš„å˜åŒ–
#### 1.automaticallyAdjustsScrollViewInsets
åœ¨iOS11ä¹‹å‰ï¼Œå¦‚æœæƒ³è¦scrollViewä¸åç§»64pï¼Œåˆ™éœ€è®¾ç½®automaticallyAdjustsScrollViewInsets=NOï¼Œä½†æ˜¯è¿™ä¸ªå±æ€§åœ¨iOS11ç›´æ¥è¢«é—å¼ƒäº†ğŸ˜³ï¼š
```
@property(nonatomic,assign) BOOL automaticallyAdjustsScrollViewInsets
API_DEPRECATED_WITH_REPLACEMENT("Use UIScrollView's contentInsetAdjustmentBehavior instead", ios(7.0,11.0),tvos(7.0,11.0));
```
æ‰€ä»¥ï¼Œçœ‹ä¸€ä¸‹contentInsetAdjustmentBehavioræ˜¯ä½•æ–¹ç¥åœ£ï¼š
```
typedef NS_ENUM(NSInteger, UIScrollViewContentInsetAdjustmentBehavior) {
    UIScrollViewContentInsetAdjustmentAutomatic, // Similar to .scrollableAxes, but will also adjust the top & bottom contentInset when the scroll view is owned by a view controller with automaticallyAdjustsScrollViewContentInset = YES inside a navigation controller, regardless of whether the scroll view is scrollable
    UIScrollViewContentInsetAdjustmentScrollableAxes, // Edges for scrollable axes are adjusted (i.e., contentSize.width/height > frame.size.width/height or alwaysBounceHorizontal/Vertical = YES)
    UIScrollViewContentInsetAdjustmentNever, // contentInset is not adjusted
    UIScrollViewContentInsetAdjustmentAlways, // contentInset is always adjusted by the scroll view's safeAreaInsets
} API_AVAILABLE(ios(11.0),tvos(11.0));

/* Configure the behavior of adjustedContentInset.
 Default is UIScrollViewContentInsetAdjustmentAutomatic.
 */
@property(nonatomic) UIScrollViewContentInsetAdjustmentBehavior contentInsetAdjustmentBehavior API_AVAILABLE(ios(11.0),tvos(11.0));
```
çœ‹èµ·æ¥è¿™å’ŒiOS11æçš„safeAreaæœ‰å…³ï¼Œè¿™ä¸ªå…ˆæ”¾ä¸€éï¼Œçœ‹çœ‹æ€ä¹ˆé€‚é…ï¼š
```
#define  adjustsScrollViewInsets_NO(scrollView,vc)\
do { \
    _Pragma("clang diagnostic push") \
    _Pragma("clang diagnostic ignored \"-Warc-performSelector-leaks\"") \
        if ([UIScrollView instancesRespondToSelector:NSSelectorFromString(@"setContentInsetAdjustmentBehavior:")]) {\
            [scrollView   performSelector:NSSelectorFromString(@"setContentInsetAdjustmentBehavior:") withObject:@(2)];\
        } else {\
            vc.automaticallyAdjustsScrollViewInsets = NO;\
        }\
    _Pragma("clang diagnostic pop") \
} while (0)
```
ä¸Šé¢æ˜¯å…¬å¸é‡Œé¢ä¸€ä¸ªå¤§ç¥å†™çš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨Xcode8ä¸Šé¢è·‘äº†ã€‚
#### 2.tableViewé»˜è®¤ä½¿ç”¨Self-Sizing
è¿™ä¸ªé…åˆestimatedRowHeightã€estimatedSectionFooterHeightã€estimatedSectionHeaderHeightä½¿ç”¨ï¼Œå¯ä»¥é¢„ä¼°é«˜åº¦ã€‚ä¹‹å‰ï¼Œè®¾ç½®headeræˆ–è€…footeré«˜åº¦ä¸º0æ—¶ï¼Œéœ€è¦è®¾ç½®height=0.1ï¼Œæ‰ä¼šèµ·ä½œç”¨ï¼Œå¦‚æœç›´æ¥è®¾ç½®ä¸º0ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤é«˜åº¦ã€‚iOS11ç”±äºè‡ªåŠ¨ä½¿ç”¨é¢„ä¼°é«˜åº¦ï¼Œæ‰€ä»¥ï¼Œå¿½ç•¥äº†è®¾ç½®çš„é«˜åº¦ï¼Œä½¿åŸæ¥çš„é«˜åº¦å¢å¤§äº†ã€‚åªè¦æŠŠè¿™å‡ ä¸ªå±æ€§è®¾ç½®ä¸º0å°±å¯ä»¥è§£å†³ã€‚

### æäº‹ä¸‰ï¼šiPhoneXåº•éƒ¨tabbarçš„é«˜åº¦æ”¹å˜
iPhoneXä¸æ­¢å¤šäº†åˆ˜æµ·ï¼Œåº•éƒ¨è¿˜æœ‰ä¸€ä¸ªåŠè§’çš„çŸ©å½¢ï¼Œä½¿å¾—tabbarå¤šå‡ºæ¥äº†34pçš„é«˜åº¦ï¼Œä¸è¿‡ä¸ç®¡å¯¼èˆªæ å’Œtabbarä¸€èˆ¬ç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨é€‚é…safeAreaã€‚

![iPhoneX tabbar.png](http://upload-images.jianshu.io/upload_images/968977-be7d00e5fded4863.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### æäº‹å››ï¼šiOS11 iPhoneXé¡µé¢pushæ—¶tabbarä½ç½®å˜åŒ–
ç›´æ¥ä¸Šå›¾ï¼š
![iOS11 iPhoneX Tabbar.gif](http://upload-images.jianshu.io/upload_images/968977-1f1703830fef106d.gif?imageMogr2/auto-orient/strip)

å¯ä»¥çœ‹åˆ°åœ¨é¡µé¢pushçš„æ—¶å€™ï¼Œtabbarçš„frameä¸Šç§»äº†ï¼Œè¿™ä¸ªåªæœ‰åœ¨iPhoneXä¸Šé¢æ‰èƒ½çœ‹åˆ°(å› ä¸ºiPhoneXçš„TabBarçš„é«˜åº¦ä¸ä¸€æ ·)ï¼Œæœ‰å¯èƒ½æ˜¯æ¨¡æ‹Ÿå™¨çš„bugï¼Œä½†æ˜¯ï¼Œå…·ä½“è¦åˆ°çœŸæœºå‡ºæ¥æ‰çŸ¥é“ã€‚ä¸‹é¢è¯´è¯´ä¿®å¤çš„å‡ ç§åŠæ³•ï¼š
###### ï¼ˆ1ï¼‰å°†å¯¼èˆªæ çš„ä»£ç†è®¾ç½®ä¸ºå½“å‰çš„controllerï¼Œç„¶ååœ¨å°†è¦å±•ç¤ºä¸‹ä¸ªé¡µé¢çš„æ–¹æ³•é‡Œä¿®æ­£TabBarçš„frameã€‚
```
- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated {
    if (![[[UIDevice currentDevice] modelName] isEqualToString: @"iPhone X"]) {
        return;
    }
    CGRect frame = self.tabBarController.tabBar.frame;
    if (frame.origin.y < ([UIScreen mainScreen].bounds.size.height - 83)) {
        frame.origin.y = [UIScreen mainScreen].bounds.size.height - 83;
        self.tabBarController.tabBar.frame = frame;
    }
}
```
###### ï¼ˆ2ï¼‰æ–°å»ºä¸€ä¸ªç±»ï¼Œç»§æ‰¿UITabBarï¼Œç„¶ååœ¨setFrame:é‡Œé¢åšåˆ¤æ–­ä¿®æ­£ï¼Œå°†æ”¹ç±»æ›¿æ¢ç³»ç»Ÿé»˜è®¤çš„TabBarã€‚
```
- (void)setFrame:(CGRect)frame {
    if ([[[UIDevice currentDevice] modelName] isEqualToString: @"iPhone X"]) {
        if (frame.origin.y < ([UIScreen mainScreen].bounds.size.height - 83)) {
            frame.origin.y = [UIScreen mainScreen].bounds.size.height - 83;
        }
    }
    [super setFrame: frame];
}
```
###### ï¼ˆ3ï¼‰å…¶ä»–æ–¹æ³•ã€‚

### æ€»ç»“ï¼š
iOS11ç³»ç»Ÿæ”¹å˜è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼ŒæŸäº›åœ°æ–¹éœ€è¦æ³¨æ„é€‚é…ï¼Œä¸ç„¶ä¼šå‡ºç°å¾ˆå¥‡æ€ªçš„ç°è±¡ã€‚æš‚æ—¶ï¼Œåœ¨iOS11é‡åˆ°è¿™ä¹ˆå¤šå‘ï¼Œä»¥åé‡åˆ°ä¼šç»§ç»­åˆ†äº«çš„ã€‚


### å‚è€ƒï¼š
[ä½ å¯èƒ½éœ€è¦ä¸ºä½ çš„ APP é€‚é… iOS 11](http://www.10tiao.com/html/330/201707/2653579210/1.html)
